SELECT NULL INST, NULL OWNER, NULL SEGMENT_NAME, NULL SQL_STATEMENTS,
  NULL LOGICAL_READS, NULL PHYSICAL_READS FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL INST, NULL OWNER, NULL SEGMENT_NAME, NULL SQL_STATEMENTS,
  NULL LOGICAL_READS, NULL PHYSICAL_READS FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT
    -1 INSTANCE_NUMBER,
    30 NUM_RECORDS
  FROM
    DUAL
),
SQL_STATEMENT_OBJECTS AS
( SELECT /*+ MATERIALIZE */
    INST_ID,
    OWNER,
    SEGMENT_NAME,
    SQL_STATEMENTS
  FROM
  ( SELECT
      OD.INST_ID,
      OD.TO_OWNER OWNER,
      OD.TO_NAME SEGMENT_NAME,
      COUNT(*) SQL_STATEMENTS,
      BI.NUM_RECORDS
    FROM
      BASIS_INFO BI,
      GV$SQL S,
      GV$OBJECT_DEPENDENCY OD
    WHERE
      ( BI.INSTANCE_NUMBER = -1 OR BI.INSTANCE_NUMBER = S.INST_ID ) AND
      S.INST_ID = OD.INST_ID AND
      S.ADDRESS = OD.FROM_ADDRESS AND
      S.HASH_VALUE = OD.FROM_HASH 
    GROUP BY 
      OD.INST_ID,
      OD.TO_OWNER,
      OD.TO_NAME,
      BI.NUM_RECORDS
    ORDER BY
      COUNT(*) DESC
  )
  WHERE
    ROWNUM <= NUM_RECORDS
) 
SELECT
  INST,
  OWNER,
  SEGMENT_NAME,
  SQL_STATEMENTS,
  LOGICAL_READS,
  PHYSICAL_READS
FROM
( SELECT
    TO_CHAR(SO.INST_ID, 990) INST,
    SO.OWNER,
    SO.SEGMENT_NAME,
    TO_CHAR(SO.SQL_STATEMENTS, 9999999999990) SQL_STATEMENTS,
    TO_CHAR(SUM(DECODE(SS.STATISTIC_NAME, 'logical reads', 
      VALUE, 0)), 999999999990) LOGICAL_READS,
    TO_CHAR(SUM(DECODE(SS.STATISTIC_NAME, 'physical reads', 
      VALUE, 0)), 9999999999990) PHYSICAL_READS  
  FROM
    SQL_STATEMENT_OBJECTS SO,
    GV$SEGSTAT SS,
    DBA_OBJECTS O
  WHERE
    SO.INST_ID = SS.INST_ID AND
    SO.OWNER = O.OWNER AND
    SO.SEGMENT_NAME = O.OBJECT_NAME AND
    O.OBJECT_ID = SS.OBJ# AND
    O.DATA_OBJECT_ID = SS.DATAOBJ# AND
    SS.STATISTIC_NAME IN ('logical reads', 'physical reads')
  GROUP BY
    SO.INST_ID,
    SO.OWNER,
    SO.SEGMENT_NAME,
    SO.SQL_STATEMENTS
  ORDER BY
    SQL_STATEMENTS DESC
)
));