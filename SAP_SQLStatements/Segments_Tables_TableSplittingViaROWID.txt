SELECT NULL BUCKET_NUMBER, NULL COMMAND FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL BUCKET_NUMBER, NULL COMMAND FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT
    'SAP%' OWNER,
    'COEP' TABLE_NAME,
    16 BUCKETS
  FROM
    DUAL
),
EXTENTS AS
( SELECT /*+ MATERIALIZE */
    E.RELATIVE_FNO,
    E.BLOCK_ID,
    E.BLOCKS,
    SUM(E.BLOCKS) OVER (ORDER BY E.RELATIVE_FNO, E.BLOCK_ID) - E.BLOCKS BLOCKS_SO_FAR_START,
    SUM(E.BLOCKS) OVER (ORDER BY E.RELATIVE_FNO, E.BLOCK_ID) BLOCKS_SO_FAR_END,
    SUM(E.BLOCKS) OVER () BLOCKS_TOTAL
  FROM
    BASIS_INFO BI,
    DBA_EXTENTS E
  WHERE
    E.OWNER LIKE BI.OWNER AND
    E.SEGMENT_NAME = BI.TABLE_NAME
  ORDER BY
    RELATIVE_FNO,
    BLOCK_ID
),
DATA_OBJECT_ID AS
( SELECT 
    O.DATA_OBJECT_ID 
  FROM 
    BASIS_INFO BI,
    DBA_OBJECTS O
  WHERE 
    O.OWNER LIKE BI.OWNER AND
    O.OBJECT_NAME = BI.TABLE_NAME
),
BUCKET_NUMBERS AS
( SELECT /*+ MATERIALIZE */ 
    ROWNUM BUCKET_NUMBER 
  FROM 
    BASIS_INFO BI,
    V$SESSTAT S
  WHERE 
    ROWNUM <= BI.BUCKETS
),
BUCKETS AS
( SELECT /*+ MATERIALIZE */
    BN.BUCKET_NUMBER, 
    TRUNC(E.BLOCKS_TOTAL / BI.BUCKETS * (BN.BUCKET_NUMBER - 1)) + 1 START_BLOCK,
    TRUNC(E.BLOCKS_TOTAL / BI.BUCKETS * BN.BUCKET_NUMBER) END_BLOCK
  FROM
    BASIS_INFO BI,
    (SELECT DISTINCT BLOCKS_TOTAL FROM EXTENTS) E,
    BUCKET_NUMBERS BN
),
BUCKET_EXTENTS AS
( SELECT /*+ MATERIALIZE LEADING(B) USE_HASH(E1 E2) */
    B.BUCKET_NUMBER,
    MAX(E1.BLOCKS_SO_FAR_START) START_EXTENT,
    MAX(E2.BLOCKS_SO_FAR_START) END_EXTENT,
    B.START_BLOCK,
    B.END_BLOCK
  FROM
    BUCKETS B,
    EXTENTS E1,
    EXTENTS E2
  WHERE
    E1.BLOCKS_SO_FAR_START <= B.START_BLOCK AND
    E2.BLOCKS_SO_FAR_START <= B.END_BLOCK
  GROUP BY
    B.BUCKET_NUMBER,
    B.START_BLOCK,
    B.END_BLOCK
),
ROWID_RANGES AS
( SELECT /*+ MATERIALIZE LEADING(BE) USE_HASH(E1 E2 DO) */
    BE.BUCKET_NUMBER,
    DBMS_ROWID.ROWID_CREATE(1, DO.DATA_OBJECT_ID, E1.RELATIVE_FNO, 
      E1.BLOCK_ID + BE.START_BLOCK - BE.START_EXTENT - 1, 0 ) START_ROWID,
    DBMS_ROWID.ROWID_CREATE(1, DO.DATA_OBJECT_ID, E2.RELATIVE_FNO, 
      E2.BLOCK_ID + BE.END_BLOCK - BE.END_EXTENT - 1, 10000 ) END_ROWID,  
    E1.RELATIVE_FNO START_FILE_NO,
    E1.BLOCK_ID + BE.START_BLOCK - BE.START_EXTENT - 1 START_BLOCK_ID,
    E2.RELATIVE_FNO END_FILE_NO,
    E2.BLOCK_ID + BE.END_BLOCK - BE.END_EXTENT - 1 END_BLOCK_ID,
    BE.START_BLOCK,
    BE.END_BLOCK,
    BE.END_BLOCK - BE.START_BLOCK BLOCKS
  FROM 
    BUCKET_EXTENTS BE,
    EXTENTS E1,
    EXTENTS E2,
    DATA_OBJECT_ID DO
  WHERE
    BE.START_EXTENT = E1.BLOCKS_SO_FAR_START AND
    BE.END_EXTENT = E2.BLOCKS_SO_FAR_START
  ORDER BY
    BE.BUCKET_NUMBER
) 
SELECT 
  RR.BUCKET_NUMBER,
  'SELECT * FROM "' || BI.TABLE_NAME || '" T WHERE T.ROWID BETWEEN ''' || 
    RR.START_ROWID || ''' AND ''' || RR.END_ROWID || ''';' COMMAND
FROM
  BASIS_INFO BI,
  ROWID_RANGES RR
ORDER BY
  RR.BUCKET_NUMBER
));