SELECT NULL AREA, NULL REQUESTS, NULL BLOCKS, NULL READTIME_S, NULL "READTIME_%",
  NULL AVG_SBR_MS, NULL "SBR_%" FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL AREA, NULL REQUESTS, NULL BLOCKS, NULL READTIME_S, NULL "READTIME_%",
  NULL AVG_SBR_MS, NULL "SBR_%" FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT 
    DECODE(INSTANCE_NUMBER, -1, USERENV('INSTANCE'), INSTANCE_NUMBER) INSTANCE_NUMBER,
    FILE_NAME,
    TABLESPACE_NAME,
    AGGREGATE_BY
  FROM
  ( SELECT
      -1 INSTANCE_NUMBER,          /* -2 for all instances, -1 for current instance */
      '%' FILE_NAME,
      '%' TABLESPACE_NAME,
      'FILE' AGGREGATE_BY       /* FILE, TABLESPACE, DRIVE or SAPDATA */
    FROM
      DUAL
  )
),
FILESTAT_HELPER AS
( SELECT
    FS.INST_ID,
    FS.FILE#,
    FS.PHYRDS,
    FS.PHYWRTS,
    FS.PHYBLKRD,
    FS.PHYBLKWRT,
    FS.SINGLEBLKRDS,
    FS.READTIM,
    FS.WRITETIM,
    FS.SINGLEBLKRDTIM,
    FS.AVGIOTIM,
    FS.LSTIOTIM,
    FS.MINIOTIM,
    FS.MAXIORTM,
    FS.MAXIOWTM,
    DF.FILE_NAME,
    DF.TABLESPACE_NAME,
    DF.BLOCKS
  FROM
    GV$FILESTAT FS,
    DBA_DATA_FILES DF
  WHERE
    FS.FILE# = DF.FILE_ID
  UNION ALL
  ( SELECT
      TS.INST_ID,
      TS.FILE#,
      TS.PHYRDS,
      TS.PHYWRTS,
      TS.PHYBLKRD,
      TS.PHYBLKWRT,
      TS.SINGLEBLKRDS,
      TS.READTIM,
      TS.WRITETIM,
      TS.SINGLEBLKRDTIM,
      TS.AVGIOTIM,
      TS.LSTIOTIM,
      TS.MINIOTIM,
      TS.MAXIORTM,
      TS.MAXIOWTM,
      TF.FILE_NAME,
      TF.TABLESPACE_NAME,
      TF.BLOCKS
    FROM
      GV$TEMPSTAT TS,
      DBA_TEMP_FILES TF
    WHERE
      TS.FILE# = TF.FILE_ID
  )
)
SELECT
  'START TIME:' AREA, 
  TO_CHAR(MIN(I.STARTUP_TIME), 'dd.mm.yyyy') REQUESTS, 
  TO_CHAR(MIN(I.STARTUP_TIME), 'hh24:mi:ss') BLOCKS, 
  NULL READTIME_S,
  NULL "READTIME_%",
  NULL AVG_SBR_MS,
  NULL "SBR_%"
FROM 
  BASIS_INFO BI,
  GV$INSTANCE I
WHERE
  BI.INSTANCE_NUMBER = -2 OR
  BI.INSTANCE_NUMBER = I.INST_ID
UNION ALL
( SELECT
    'END TIME:' AREA, 
    TO_CHAR(SYSDATE, 'dd.mm.yyyy') REQUESTS, 
    TO_CHAR(SYSDATE, 'hh24:mi:ss') BLOCKS, 
    NULL READTIME_S,
    NULL "READTIME_%",
    NULL AVG_SBR_MS,
    NULL "SBR_%"
  FROM 
    DUAL
)
UNION ALL
( SELECT
    'INSTANCE:' AREA, 
    DECODE(INSTANCE_NUMBER, -2, 'ALL', INSTANCE_NUMBER) REQUESTS, 
    NULL BLOCKS,
    NULL READTIME_S,
    NULL "READTIME_%",
    NULL AVG_SBR_MS,
    NULL "SBR_%"
  FROM 
    BASIS_INFO
)
UNION ALL
( SELECT
    'AGGREGATE BY:' AREA, 
    AGGREGATE_BY REQUESTS, 
    NULL BLOCKS,
    NULL READTIME_S,
    NULL "READTIME_%",
    NULL AVG_SBR_MS,
    NULL "SBR_%"
  FROM 
    BASIS_INFO
)
UNION ALL
( SELECT 
    'FILE NAME:' AREA, 
    FILE_NAME REQUESTS, 
    NULL BLOCKS,
    NULL READTIME_S,
    NULL "READTIME_%",
    NULL AVG_SBR_MS,
    NULL "SBR_%"
  FROM 
    BASIS_INFO
  WHERE
    FILE_NAME != '%'
)
UNION ALL
( SELECT 
    'TABLESPACE NAME:' AREA, 
    TABLESPACE_NAME REQUESTS, 
    NULL BLOCKS,
    NULL READTIME_S,
    NULL "READTIME_%",
    NULL AVG_SBR_MS,
    NULL "SBR_%"
  FROM 
    BASIS_INFO
  WHERE
    TABLESPACE_NAME != '%'
)
UNION ALL
( SELECT 
    NULL AREA, 
    NULL REQUESTS,
    NULL BLOCKS,
    NULL READTIME_S,
    NULL "READTIME_%",
    NULL AVG_SBR_MS,
    NULL "SBR_%"
  FROM 
    DUAL
)
UNION ALL
( SELECT
    AREA,
    REQUESTS,
    BLOCKS,
    READTIME_S,
    "READTIME_%",
    AVG_SBR_MS,
    "SBR_%"
  FROM
  ( SELECT
      DECODE(AGGREGATE_BY,  
        'FILE', FILE_NAME,
        'TABLESPACE', TABLESPACE_NAME,
        'DRIVE', DRIVE,
        'SAPDATA', SAPDATA) AREA,
      TO_CHAR(SUM(BR), 9999999990) REQUESTS,
      TO_CHAR(SUM(BLKS_READ), 99999999990) BLOCKS,
      TO_CHAR(SUM(BR_TIME_S), 9999999990) READTIME_S,
      TO_CHAR(RATIO_TO_REPORT(SUM(BR_TIME_S)) OVER () * 100, 999990.99) "READTIME_%",
      TO_CHAR(DECODE(SUM(SBR), 0, 0, SUM(SBR_TIME_S) * 1000 / SUM(SBR)), 999990.99) AVG_SBR_MS,
      TO_CHAR(DECODE(SUM(BR), 0, 0, SUM(SBR) / SUM(BR) * 100), 990.99) "SBR_%"
    FROM
    ( SELECT
        FS.FILE_NAME,
        FS.TABLESPACE_NAME,
        DECODE(INSTR(UPPER(FS.FILE_NAME), 'SAPDATA'), 0, 
          DECODE(INSTR(UPPER(FS.FILE_NAME), 'SAPTEMP'), 0, 'n/a',
          REGEXP_REPLACE(FS.FILE_NAME, '.*(saptemp[0-9]+).*', '\1', 1, 1, 'i')),
          REGEXP_REPLACE(FS.FILE_NAME, '.*(sapdata[0-9]+).*', '\1', 1, 1, 'i'))
          SAPDATA,
        DECODE(SUBSTR(FS.FILE_NAME, 2, 1), ':', 
          SUBSTR(FS.FILE_NAME, 1, 2), 'n/a') DRIVE,
        FS.PHYRDS BR,
        FS.READTIM / 100 BR_TIME_S,
        FS.BLOCKS FB,
        FS.SINGLEBLKRDS SBR,
        FS.PHYRDS - FS.SINGLEBLKRDS MBR,
        FS.PHYBLKRD BLKS_READ,
        FS.READTIM * 10 / FS.PHYRDS AVG_BR_MS,
        FS.SINGLEBLKRDTIM / 100 SBR_TIME_S,
        DECODE(FS.SINGLEBLKRDS, 0, 0, FS.SINGLEBLKRDTIM * 10 / FS.SINGLEBLKRDS) AVG_SBR_MS,
        BI.AGGREGATE_BY
      FROM
        BASIS_INFO BI,
        FILESTAT_HELPER FS
      WHERE
        ( BI.INSTANCE_NUMBER = -2 OR
          BI.INSTANCE_NUMBER = FS.INST_ID ) AND
        FS.FILE_NAME LIKE BI.FILE_NAME AND
        FS.TABLESPACE_NAME LIKE BI.TABLESPACE_NAME
    )
    GROUP BY
      DECODE(AGGREGATE_BY,
        'FILE', FILE_NAME,
        'TABLESPACE', TABLESPACE_NAME,
        'DRIVE', DRIVE,
        'SAPDATA', SAPDATA)
    ORDER BY
      READTIME_S DESC
  )
)
));
