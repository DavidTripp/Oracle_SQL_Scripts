SELECT NULL NAME, NULL FILE_TYPE, NULL BLOCK_SIZE, NULL FILESIZE_MB FROM DUAL WHERE 1=0 
UNION ALL
(SELECT NULL NAME, NULL FILE_TYPE, NULL BLOCK_SIZE, NULL FILESIZE_MB FROM DUAL WHERE 1=0)
UNION ALL
SELECT * FROM (
WITH ALIAS_HELP AS
(		SELECT 
			AD.NAME DGNAME,
			AA.NAME ALIASNAME, 
			AA.SYSTEM_CREATED SYSCREATE,
			AA.ALIAS_DIRECTORY DIR,
			AA.REFERENCE_INDEX AAREFERENCE_INDEX, 
			AA.PARENT_INDEX AAPARENT_INDEX, 
			AA.FILE_NUMBER AAFILE_NUMBER,
			AF.TYPE AFFILETYPE,
			AF.BLOCK_SIZE AFBLOCKSIZE,
			AF.BYTES/1024/1024 AFFILESIZE_MB
		FROM 
			V$ASM_ALIAS AA,
			V$ASM_DISKGROUP AD,
			V$ASM_FILE AF
		WHERE
			AA.GROUP_NUMBER = AD.GROUP_NUMBER AND
			AF.FILE_NUMBER (+) = AA.FILE_NUMBER AND
			AF.GROUP_NUMBER (+) = AA.GROUP_NUMBER
)
SELECT
	LPAD(' ', 2 * (FILE_LEVEL - 1)) || DECODE(FILE_LEVEL,1,'+'||DGNAME||'/','') || ALIASNAME2 NAME,
	DECODE(AFFILETYPE,NULL,LPAD(' ', 2 * (FILE_LEVEL - 1))||'<DIR>',LPAD(' ', 2 * (FILE_LEVEL - 1))||AFFILETYPE) FILE_TYPE,
	DECODE(AFBLOCKSIZE,0,'',TO_CHAR(AFBLOCKSIZE,'99999')) BLOCK_SIZE,
	DECODE(AFFILESIZE_MB,0,'',TO_CHAR(AFFILESIZE_MB,'99999999990.99')) FILESIZE_MB
FROM
(
	SELECT
		DGNAME,
		ALIASNAME,
		ALIASNAME2,
		AFFILETYPE,
		AFBLOCKSIZE,
		AFFILESIZE_MB,
		LEVEL FILE_LEVEL
	FROM
	(
	SELECT
		DGNAME,
		ALIASNAME,
		ALIASNAME ALIASNAME2,
		SYSCREATE,
		AAREFERENCE_INDEX,
		AAPARENT_INDEX,
		AFFILETYPE,
		AFBLOCKSIZE,
		AFFILESIZE_MB
	FROM
		ALIAS_HELP
	WHERE
		DIR = 'Y'
	UNION ALL
	SELECT
		DGNAME,
		ALIASNAME,
		DECODE	(	INSTR(ALIASNAME2,'#'),'0',ALIASNAME2,
					DECODE	(	SYSCREATE,'Y', ALIASNAME||' <- '||SUBSTR(ALIASNAME2, INSTR(ALIASNAME2,'#')+1),
								'N', ALIASNAME||' -> '||SUBSTR(ALIASNAME2,1,INSTR(ALIASNAME2,'#')-1)
							)
				) ALIASNAME2,
		SYSCREATE,
		AAREFERENCE_INDEX,
		AAPARENT_INDEX,
		AFFILETYPE,
		AFBLOCKSIZE,
		AFFILESIZE_MB
	FROM
	(
		SELECT
			DGNAME,
			ALIASNAME,
			LISTAGG(ALIASNAME, '#') 
				WITHIN GROUP (ORDER BY SYSCREATE DESC)
				OVER (PARTITION BY DGNAME, AAFILE_NUMBER) ALIASNAME2,
			SYSCREATE,
			AAREFERENCE_INDEX,
			AAPARENT_INDEX,
			AFFILETYPE,
			AFBLOCKSIZE,
			AFFILESIZE_MB
		FROM
			ALIAS_HELP
		WHERE
			DIR = 'N' 
	)	
	)
	START WITH 
		ALIASNAME IN 
				( 	SELECT 
						UNIQUE NAME 
					FROM 
						V$ASM_ALIAS
					WHERE 
						PARENT_INDEX NOT IN (SELECT REFERENCE_INDEX FROM V$ASM_ALIAS)
				)
	CONNECT BY NOCYCLE
		PRIOR AAREFERENCE_INDEX = AAPARENT_INDEX
	ORDER SIBLINGS BY 
		ALIASNAME
)
);