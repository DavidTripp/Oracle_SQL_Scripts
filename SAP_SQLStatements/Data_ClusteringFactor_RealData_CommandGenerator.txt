SELECT NULL LINE FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL LINE FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT
    OWNER,
    TABLE_NAME,
    REPLACE(COLUMN_LIST, ', ', ',') COLUMN_LIST,
    PARALLEL_DEGREE
  FROM
  ( SELECT
      '%' OWNER,
      'VDBEKI' TABLE_NAME,
      'MANDT, BUKRS, RANL' COLUMN_LIST,    /* comma separated, only used if INDEX_NAME = '%' */
      32 PARALLEL_DEGREE
    FROM
       DUAL
  )
)
SELECT 'SELECT NULL TABLE_NAME, NULL COLUMN_LIST, NULL NUM_ROWS, NULL BLOCKS,' LINE FROM DUAL
UNION ALL
( SELECT '  NULL CLST_FACTOR, NULL CLF_IMP_RATIO, NULL CLF_REG_RATIO FROM DUAL WHERE 1 = 0' FROM DUAL )
UNION ALL
( SELECT 'UNION ALL (' FROM DUAL )
UNION ALL
( SELECT 'SELECT NULL TABLE_NAME, NULL COLUMN_LIST, NULL NUM_ROWS, NULL BLOCKS,' LINE FROM DUAL )
UNION ALL
( SELECT '  NULL CLST_FACTOR, NULL CLF_IMP_RATIO, NULL CLF_REG_RATIO FROM DUAL WHERE 1 = 0' FROM DUAL )
UNION ALL
( SELECT ') UNION ALL ( SELECT * FROM (' FROM DUAL )
UNION ALL
( SELECT 'WITH ROW_INFO AS' FROM DUAL )
UNION ALL
( SELECT '( SELECT' FROM BASIS_INFO )
UNION ALL
( SELECT '  /*+ PARALLEL("' || TABLE_NAME || '" ' || PARALLEL_DEGREE || ')' FROM BASIS_INFO WHERE PARALLEL_DEGREE NOT IN (-1, 1) )
UNION ALL
( SELECT '      PARALLEL_INDEX("' || BI.TABLE_NAME || '" "' || I.INDEX_NAME || '" ' || BI.PARALLEL_DEGREE || ')' FROM
    BASIS_INFO BI,
    DBA_INDEXES I
  WHERE
    I.TABLE_OWNER LIKE BI.OWNER AND
    I.TABLE_NAME = BI.TABLE_NAME AND
    BI.PARALLEL_DEGREE NOT IN (-1, 1)
)
UNION ALL
( SELECT '  */' FROM BASIS_INFO WHERE PARALLEL_DEGREE NOT IN (-1, 1) )
UNION ALL
( SELECT '  SUBSTRB(ROWID, 1, 15) BLOCK_ID' FROM DUAL )
UNION ALL
( SELECT 'FROM' FROM DUAL )
UNION ALL
( SELECT '  ' || DECODE(OWNER, '%', '', '"' || OWNER || '".') || '"' || TABLE_NAME || '"' FROM BASIS_INFO )
UNION ALL
( SELECT 'ORDER BY' FROM DUAL )
UNION ALL
( SELECT '  ' || COLUMN_LIST || ',ROWID' FROM BASIS_INFO )
UNION ALL
( SELECT ')' FROM DUAL )
UNION ALL
( SELECT 'SELECT' FROM DUAL )
UNION ALL
( SELECT '  ''' || TABLE_NAME || ''' TABLE_NAME,' FROM BASIS_INFO )
UNION ALL
( SELECT '  ''' || COLUMN_LIST || ''' COLUMN_LIST,' FROM BASIS_INFO )
UNION ALL
( SELECT '  TO_CHAR(NUM_ROWS, 999999999990) NUM_ROWS,' FROM DUAL )
UNION ALL
( SELECT '  TO_CHAR(BLOCKS, 999999990) BLOCKS,' FROM DUAL )
UNION ALL
( SELECT '  TO_CHAR(CLUSTERING_FACTOR, 99999999990) CLST_FACTOR,' FROM DUAL )
UNION ALL
( SELECT '  TO_CHAR(CLUSTERING_FACTOR / BLOCKS, 999999990.99) CLF_IMP_RATIO,' FROM DUAL )
UNION ALL
( SELECT '  TO_CHAR(NUM_ROWS / CLUSTERING_FACTOR, 999999990.99) CLF_REG_RATIO' FROM DUAL )
UNION ALL
( SELECT 'FROM' FROM DUAL )
UNION ALL
( SELECT '( SELECT' FROM DUAL )
UNION ALL
( SELECT '    COUNT(*) NUM_ROWS,' FROM DUAL )
UNION ALL
( SELECT '    COUNT(DISTINCT(BLOCK_ID)) BLOCKS,' FROM DUAL )
UNION ALL
( SELECT '    SYS_OP_COUNTCHG(BLOCK_ID, 1) CLUSTERING_FACTOR' FROM DUAL )
UNION ALL
( SELECT '  FROM' FROM DUAL )
UNION ALL
( SELECT '    ROW_INFO' FROM BASIS_INFO )
UNION ALL
( SELECT ')' FROM DUAL )
UNION ALL
( SELECT '));' FROM DUAL )
));
