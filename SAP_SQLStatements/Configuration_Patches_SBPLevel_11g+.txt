SELECT NULL VERSION, NULL SBP_IMPLEMENTATION_TIME, NULL SBP_REGISTRY, 
  NULL SBP_FIX_CONTROL_MIN, NULL SBP_FIX_CONTROL_MAX FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL VERSION, NULL SBP_IMPLEMENTATION_TIME, NULL SBP_REGISTRY, 
  NULL SBP_FIX_CONTROL_MIN, NULL SBP_FIX_CONTROL_MAX FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH FIX_CONTROL_SBP_MAPPING AS
( SELECT '11.2.0.1' PATCHSET, '201006' SBP_MIN, '201007' SBP_MAX, 9495669 BUGNO FROM DUAL UNION ALL
  ( SELECT '11.2.0.1', '201009', '201104',  8937971 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.1', '201105', '201107',  6055658 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.1', '201108', '201111', 12591120 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201011', '201102', 10134677 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201103', '201104', 11699884 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201105', '201105',  6055658 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201106', '201107', 11892888 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201108', '201109', 12591120 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201110', '201112', 12827166 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201201', '201201', 13077335 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201202', '201202', 13524237 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201203', '201204', 13594712 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201205', '201207', 13777823 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201208', '201208', 13627489 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201209', '201301', 14255600 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201302', '201302', 13891981 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201305', '201305', 14723910 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.2', '201308', '201311', 14712222 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201112', '201201', 12622441 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201202', '201202', 13524237 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201203', '201204', 13594712 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201205', '201206', 13777823 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201207', '201209', 13627489 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201210', '201210', 14255600 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201211', '201301', 14467202 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201302', '201302', 13891981 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201303', '201305', 14723910 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201306', '201306', 14712222 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201308', '201309', 16092378 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201311', '201311', 16976121 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201312', '201402', 16470836 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201406', '201406', 18035463 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201408', '201408', 18405517 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.3', '201411', '201411',  4483286 FROM DUAL )  UNION ALL
  ( SELECT '11.2.0.4', '201402', '201402', 16470836 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.4', '201406', '201406', 18035463 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.4', '201408', '201408', 18405517 FROM DUAL ) UNION ALL
  ( SELECT '11.2.0.4', '201411', '201411',  4483286 FROM DUAL ) 
),
SBP_LEVEL_FIX_CONTROL AS
( SELECT
    TO_CHAR(MAX(SBP_MIN)) SBP_LEVEL_MIN,
    TO_CHAR(MAX(SBP_MAX)) SBP_LEVEL_MAX
  FROM
    FIX_CONTROL_SBP_MAPPING FSM,
    V$INSTANCE I,
    V$SYSTEM_FIX_CONTROL SFC
  WHERE
    SUBSTR(I.VERSION, 1, 8) = FSM.PATCHSET AND
    SFC.BUGNO = FSM.BUGNO
),
SBP_LEVEL_REGISTRY AS
( SELECT
    ACTION_TIME,
    TO_CHAR(ID) SBP_LEVEL
  FROM
  ( SELECT
      RH.ACTION_TIME,
      RH.ID
    FROM
      DBA_REGISTRY_HISTORY RH,
      V$INSTANCE I
    WHERE
      SUBSTR(RH.COMMENTS, 1, 3) = 'SBP' AND
      SUBSTR(I.VERSION, 1, 8) = SUBSTR(RH.VERSION, 1, 8)
    ORDER BY
      RH.ID DESC
  )
  WHERE
    ROWNUM = 1
)
SELECT
  ( SELECT VERSION FROM V$INSTANCE ) VERSION,
  DECODE(SR.ACTION_TIME, NULL, 'n/a', TO_CHAR(SR.ACTION_TIME, 'dd.mm.yyyy hh24:mi:ss')) SBP_IMPLEMENTATION_TIME,
  DECODE(SR.SBP_LEVEL, NULL, 'n/a', SUBSTR(SR.SBP_LEVEL, 5, 2) || '/' || SUBSTR(SR.SBP_LEVEL, 1, 4)) SBP_REGISTRY,
  DECODE(SF.SBP_LEVEL_MIN, NULL, 'n/a', SUBSTR(SF.SBP_LEVEL_MIN, 5, 2) || '/' || SUBSTR(SF.SBP_LEVEL_MIN, 1, 4)) SBP_FIX_CONTROL_MIN,
  DECODE(SF.SBP_LEVEL_MAX, NULL, 'n/a', SUBSTR(SF.SBP_LEVEL_MAX, 5, 2) || '/' || SUBSTR(SF.SBP_LEVEL_MAX, 1, 4)) SBP_FIX_CONTROL_MAX
FROM
  SBP_LEVEL_REGISTRY SR FULL OUTER JOIN
  SBP_LEVEL_FIX_CONTROL SF ON 
    1 = 1
));
