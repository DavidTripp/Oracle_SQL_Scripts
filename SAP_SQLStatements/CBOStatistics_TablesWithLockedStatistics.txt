SELECT NULL OWNER, NULL TABLE_NAME, NULL LOCK_TYPE, NULL DELIVERED FROM DUAL WHERE 1 = 0
UNION ALL ( 
SELECT NULL OWNER, NULL TABLE_NAME, NULL LOCK_TYPE, NULL DELIVERED FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT
    'SAP%' OWNER,
    '%' TABLE_NAME,
    'X' EXCLUDE_DELIVERED_STATISTICS
  FROM
    DUAL
),
DELIVERED_STATS AS
( SELECT 'F' STAT_LEVEL, 'ARFCRSTATE' TABLE_NAME FROM DUAL UNION
  SELECT 'F', 'ARFCSDATA' FROM DUAL UNION
  SELECT 'F', 'ARFCSSTATE' FROM DUAL UNION
  SELECT 'F', 'DDXTT' FROM DUAL UNION
  SELECT 'F', 'DDXTF' FROM DUAL UNION
  SELECT 'F', 'QREFTID' FROM DUAL UNION
  SELECT 'F', 'SXMSCLUP' FROM DUAL UNION
  SELECT 'F', 'SXMSCLUP2' FROM DUAL UNION
  SELECT 'F', 'SXMSCLUR' FROM DUAL UNION
  SELECT 'F', 'SXMSCLUR2' FROM DUAL UNION
  SELECT 'F', 'SXMSPEMAS' FROM DUAL UNION
  SELECT 'F', 'SXMSPEMAS2' FROM DUAL UNION
  SELECT 'F', 'SXMSPERROR' FROM DUAL UNION
  SELECT 'F', 'SXMSPERRO2' FROM DUAL UNION
  SELECT 'F', 'SXMSPHIST' FROM DUAL UNION
  SELECT 'F', 'SXMSPHIST2' FROM DUAL UNION
  SELECT 'F', 'SXMSPMAST' FROM DUAL UNION
  SELECT 'F', 'SXMSPMAST2' FROM DUAL UNION
  SELECT 'F', 'SXMSPVERS' FROM DUAL UNION
  SELECT 'F', 'SXMSPVERS2' FROM DUAL UNION
  SELECT 'F', 'TATAF' FROM DUAL UNION
  SELECT 'F', 'TESTDATRNRPART0' FROM DUAL UNION
  SELECT 'F', 'TRBAT' FROM DUAL UNION
  SELECT 'F', 'TRBAT2' FROM DUAL UNION
  SELECT 'F', 'TRFCQDATA' FROM DUAL UNION
  SELECT 'F', 'TRFCQIN' FROM DUAL UNION
  SELECT 'F', 'TRFCQOUT' FROM DUAL UNION
  SELECT 'F', 'TRFCQSTATE' FROM DUAL UNION
  SELECT 'F', 'SMOEJOBID' FROM DUAL UNION
  SELECT 'F', 'SMOFCDBHD' FROM DUAL UNION
  SELECT 'F', 'SMOFCMPDAT' FROM DUAL UNION
  SELECT 'F', 'SMOFCMPHD' FROM DUAL UNION
  SELECT 'F', 'SMOFCMPOBJ' FROM DUAL UNION
  SELECT 'F', 'SMOHJOBQ' FROM DUAL UNION
  SELECT 'F', 'SMOHMSGQ' FROM DUAL UNION
  SELECT 'F', 'SMOHMSGQRE' FROM DUAL UNION
  SELECT 'F', 'SMOHSITEQ' FROM DUAL UNION
  SELECT 'F', 'SMOHSITEQEX' FROM DUAL UNION
  SELECT 'F', 'SMOHSITEQRD' FROM DUAL UNION
  SELECT 'F', 'XI_AF_SVC_ID_MAP' FROM DUAL UNION ALL
  SELECT 'F', 'XI_IDOC_IN_MSG' FROM DUAL UNION ALL
  SELECT 'F', 'XI_IDOC_OUT_MSG' FROM DUAL
)
SELECT
  OWNER,
  TABLE_NAME,
  LOCK_TYPE,
  DELIVERED
FROM
( SELECT DISTINCT
    TS.OWNER,
    TS.TABLE_NAME,
    TS.STATTYPE_LOCKED LOCK_TYPE,
    DECODE(DS.TABLE_NAME, NULL, ' ', 'X') DELIVERED,
    BI.EXCLUDE_DELIVERED_STATISTICS
  FROM
    BASIS_INFO BI,
    DBA_TAB_STATISTICS TS,
    DELIVERED_STATS DS
  WHERE
    TS.OWNER LIKE BI.OWNER AND
    TS.TABLE_NAME LIKE BI.TABLE_NAME AND
    TS.STATTYPE_LOCKED IS NOT NULL AND
    TS.TABLE_NAME = DS.TABLE_NAME (+)
)
WHERE
  EXCLUDE_DELIVERED_STATISTICS = ' ' OR DELIVERED = ' '
ORDER BY
  OWNER,
  TABLE_NAME
));

