SELECT NULL OWNER, NULL SEGMENT_NAME, NULL PART_NAME, NULL TSP_NAME, NULL SEGMENT_TYPE,
  NULL EXTENTS, NULL NEXT_MB, NULL SIZE_GB, NULL EXTENT_MANAGEMENT FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL OWNER, NULL SEGMENT_NAME, NULL PART_NAME, NULL TSP_NAME, NULL SEGMENT_TYPE,
  NULL EXTENTS, NULL NEXT_MB, NULL SIZE_GB, NULL EXTENT_MANAGEMENT FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT
    1000 EXTENT_THRESHOLD,
    'DMTS' TABLESPACE_TYPE               /* 'DMTS', 'LMTS', 'ALL' */
  FROM
    DUAL
)
SELECT
  DS.OWNER OWNER,
  DS.SEGMENT_NAME SEGMENT_NAME,
  DS.PARTITION_NAME PARTITION_NAME,
  DS.TABLESPACE_NAME TABLESPACE_NAME,
  DS.SEGMENT_TYPE SEGMENT_TYPE,
  TO_CHAR(DS.EXTENTS, 9999990) EXTENTS,
  TO_CHAR(DS.NEXT_EXTENT / 1024 / 1024, 9990.99) NEXT_MB,
  TO_CHAR(DS.BYTES / 1024 / 1024 / 1024, 9990.99) SIZE_GB,
  DT.EXTENT_MANAGEMENT EXTENT_MANAGEMENT
FROM
  BASIS_INFO BI,
  DBA_SEGMENTS DS,
  DBA_TABLESPACES DT
WHERE
  DS.TABLESPACE_NAME = DT.TABLESPACE_NAME AND
  DS.EXTENTS >= BI.EXTENT_THRESHOLD AND
  ( BI.TABLESPACE_TYPE = 'DMTS' AND DT.EXTENT_MANAGEMENT = 'DICTIONARY' OR
    BI.TABLESPACE_TYPE = 'LMTS' AND DT.EXTENT_MANAGEMENT = 'LOCAL' OR
    BI.TABLESPACE_TYPE = 'ALL'
  )
ORDER BY
  DS.EXTENTS DESC
));
