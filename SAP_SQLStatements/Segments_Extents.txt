SELECT NULL OWNER, NULL SEGMENT_NAME, NULL PART_NAME, NULL TABLESPACE_NAME,
  NULL SIZE_MB, NULL NUM_EXTENTS FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL OWNER, NULL SEGMENT_NAME, NULL PART_NAME, NULL TABLESPACE_NAME,
  NULL SIZE_MB, NULL NUM_EXTENTS FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT
    '%' OWNER,
    'AAA' SEGMENT_NAME,
    '%' PARTITION_NAME, 
    '%' TABLESPACE_NAME
  FROM
    DUAL
)
SELECT
  E.OWNER,
  E.SEGMENT_NAME,
  E.PARTITION_NAME PART_NAME,
  E.TABLESPACE_NAME,
  TO_CHAR(E.BYTES / 1024 / 1024, 9990.99) SIZE_MB,
  COUNT(*) NUM_EXTENTS
FROM
  BASIS_INFO BI,
  DBA_EXTENTS E
WHERE
  E.OWNER LIKE BI.OWNER AND
  E.SEGMENT_NAME LIKE BI.SEGMENT_NAME AND
  ( BI.PARTITION_NAME = '%' OR E.PARTITION_NAME LIKE BI.PARTITION_NAME ) AND
  E.TABLESPACE_NAME LIKE BI.TABLESPACE_NAME 
GROUP BY
  E.OWNER,
  E.SEGMENT_NAME,
  E.PARTITION_NAME,
  E.TABLESPACE_NAME,
  E.BYTES
ORDER BY
  E.OWNER,
  E.SEGMENT_NAME,
  E.PARTITION_NAME,
  E.TABLESPACE_NAME,
  E.BYTES DESC  
));

  

