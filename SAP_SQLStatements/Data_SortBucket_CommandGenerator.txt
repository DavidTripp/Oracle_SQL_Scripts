SELECT NULL LINE FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL LINE FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT
    '%' OWNER,
    'DFKKKO' TABLE_NAME,
    'CPUTM' SORT_COLUMNS,
    200 NUM_BUCKETS,
    1 SAMPLE_SIZE_PCT,
    32 PARALLEL_DEGREE,
    'CPUDT <= ''20101111''' RESTRICTION_CONDITION
  FROM
    DUAL
)
SELECT 'SELECT NULL BUCKET, NULL MIN_VALUE, NULL MAX_VALUE, NULL NUM_ROWS_ESTIMATED FROM DUAL WHERE 1 = 0' FROM DUAL
UNION ALL
( SELECT 'UNION ALL (' FROM DUAL )
UNION ALL
( SELECT 'SELECT NULL BUCKET, NULL MIN_VALUE, NULL MAX_VALUE, NULL NUM_ROWS_ESTIMATED FROM DUAL WHERE 1 = 0' FROM DUAL )
UNION ALL
( SELECT ') UNION ALL ( SELECT * FROM (' FROM DUAL )
UNION ALL
( SELECT 'SELECT' FROM DUAL )
UNION ALL
( SELECT '  BUCKET,' FROM DUAL )
UNION ALL
( SELECT '  MIN(' || REPLACE(SORT_COLUMNS, ',', ' || '' '' ||') || ') MIN_VALUE,' FROM BASIS_INFO )
UNION ALL
( SELECT '  MAX(' || REPLACE(SORT_COLUMNS, ',', ' || '' '' ||') || ') MAX_VALUE,' FROM BASIS_INFO )
UNION ALL
( SELECT '  TO_CHAR(COUNT(*) * 100 / ' || SAMPLE_SIZE_PCT || ', 99999999999999990) NUM_ROWS_ESTIMATED' FROM BASIS_INFO)
UNION ALL
( SELECT 'FROM' FROM DUAL )
UNION ALL
( SELECT '( SELECT' FROM DUAL )
UNION ALL
( SELECT '    /*+ PARALLEL("' || TABLE_NAME || '" ' || PARALLEL_DEGREE || ')' FROM BASIS_INFO WHERE PARALLEL_DEGREE NOT IN (-1, 1) )
UNION ALL
( SELECT '        PARALLEL_INDEX("' || BI.TABLE_NAME || '" "' || I.INDEX_NAME || '" ' || BI.PARALLEL_DEGREE || ')' FROM
    BASIS_INFO BI,
    DBA_INDEXES I
  WHERE
    I.TABLE_OWNER LIKE BI.OWNER AND
    I.TABLE_NAME = BI.TABLE_NAME AND
    BI.PARALLEL_DEGREE NOT IN (-1, 1)
)
UNION ALL
( SELECT '    */' FROM BASIS_INFO WHERE PARALLEL_DEGREE NOT IN (-1, 1) )
UNION ALL
( SELECT '    ' || SORT_COLUMNS || ',' FROM BASIS_INFO )
UNION ALL
( SELECT '    NTILE(' || NUM_BUCKETS || ') OVER (ORDER BY ' || SORT_COLUMNS || ') BUCKET' FROM BASIS_INFO )
UNION ALL
( SELECT '  FROM' FROM DUAL )
UNION ALL
( SELECT '    ' || DECODE(OWNER, '%', NULL, '"' || OWNER || '".') || '"' || TABLE_NAME || '"' FROM BASIS_INFO )
UNION ALL
( SELECT '  SAMPLE(' || SAMPLE_SIZE_PCT || ')' FROM BASIS_INFO WHERE SAMPLE_SIZE_PCT < 100 )
UNION ALL
( SELECT '  WHERE' FROM BASIS_INFO WHERE RESTRICTION_CONDITION IS NOT NULL )
UNION ALL
( SELECT '    ' || RESTRICTION_CONDITION FROM BASIS_INFO WHERE RESTRICTION_CONDITION IS NOT NULL )
UNION ALL
( SELECT ')' FROM DUAL )
UNION ALL
( SELECT 'GROUP BY' FROM DUAL )
UNION ALL
( SELECT '  BUCKET' FROM DUAL )
UNION ALL
( SELECT 'ORDER BY' FROM DUAL )
UNION ALL
( SELECT '  BUCKET' FROM DUAL )
UNION ALL
( SELECT '));' FROM DUAL )
));

