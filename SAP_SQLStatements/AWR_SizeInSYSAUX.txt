SELECT NULL CURRENT_AWR_RETENTION_DAYS, NULL TARGET_AWR_RETENTION_DAYS,
  NULL CURRENT_AWR_SPACE_GB, NULL TARGET_AWR_SPACE_GB,
  NULL DIFF_SPACE_GB FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL CURRENT_AWR_RETENTION_DAYS, NULL TARGET_AWR_RETENTION_DAYS,
  NULL CURRENT_AWR_SPACE_GB, NULL TARGET_AWR_SPACE_GB,
  NULL DIFF_SPACE_GB FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT /*+ MATERIALIZE */
    DECODE(DBID, -1, OWN_DBID, DBID) DBID,
    DECODE(INSTANCE_NUMBER, -1, USERENV('INSTANCE'), INSTANCE_NUMBER) INSTANCE_NUMBER,
    TARGET_AWR_RETENTION_DAYS
  FROM
  ( SELECT
      -1 DBID,
      -1 INSTANCE_NUMBER,
      42 TARGET_AWR_RETENTION_DAYS
    FROM
      DUAL
   ),
   ( SELECT DBID OWN_DBID FROM V$DATABASE )
)
SELECT
  TO_CHAR(CURRENT_AWR_RETENTION_DAYS, 9999999999999999999990.99) CURRENT_AWR_RETENTION_DAYS,
  TO_CHAR(TARGET_AWR_RETENTION_DAYS, 999999999999999999990.99) TARGET_AWR_RETENTION_DAYS,
  TO_CHAR(CURRENT_AWR_SPACE_GB, 9999999999999990.99) CURRENT_AWR_SPACE_GB,
  TO_CHAR(TARGET_AWR_RETENTION_DAYS / CURRENT_AWR_RETENTION_DAYS * 
    CURRENT_AWR_SPACE_GB, 999999999999990.99 ) TARGET_AWR_SPACE_GB,
  TO_CHAR(TARGET_AWR_RETENTION_DAYS / CURRENT_AWR_RETENTION_DAYS *
    CURRENT_AWR_SPACE_GB - CURRENT_AWR_SPACE_GB, 999999990.99) DIFF_SPACE_GB
FROM
( SELECT
    BI.TARGET_AWR_RETENTION_DAYS,
    TO_CHAR(ROUND(EXTRACT(DAY FROM HWC.RETENTION) +
      EXTRACT(HOUR FROM HWC.RETENTION) / 24 + 
      EXTRACT(MINUTE FROM HWC.RETENTION) / 1440, 2), 99990) CURRENT_AWR_RETENTION_DAYS,
    SO.SPACE_USAGE_KBYTES / 1024 / 1024 CURRENT_AWR_SPACE_GB
  FROM
    BASIS_INFO BI,
    DBA_HIST_WR_CONTROL HWC,
    GV$SYSAUX_OCCUPANTS SO
  WHERE
    BI.DBID = HWC.DBID AND
    BI.INSTANCE_NUMBER = SO.INST_ID AND
    SO.OCCUPANT_DESC = 
      'Server Manageability - Automatic Workload Repository'
)
));
