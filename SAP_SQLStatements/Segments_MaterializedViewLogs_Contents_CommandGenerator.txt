SELECT NULL LINE FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL LINE FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT
    '%' LOG_OWNER,
    '%' LOG_TABLE_NAME,
    '%' MASTER_TABLE_NAME
  FROM
    DUAL
),
MVIEW_LOGS AS
( SELECT
    MVL.LOG_OWNER,
    MVL.LOG_TABLE,
    MVL.MASTER MASTER_TABLE,
    MVL.LAST_PURGE_DATE,
    S.BYTES,
    ROWNUM MVIEW_POS
  FROM
    BASIS_INFO BI,
    DBA_MVIEW_LOGS MVL,
    DBA_SEGMENTS S
  WHERE
    MVL.LOG_OWNER LIKE BI.LOG_OWNER AND
    MVL.MASTER LIKE BI.MASTER_TABLE_NAME AND
    MVL.LOG_TABLE LIKE BI.LOG_TABLE_NAME AND
    S.OWNER = MVL.LOG_OWNER AND
    S.SEGMENT_NAME = MVL.LOG_TABLE
  ORDER BY
    MVL.LOG_OWNER,
    MVL.LOG_TABLE
)
SELECT   'SELECT NULL LOG_OWNER, NULL LOG_TABLE, NULL MASTER_TABLE, NULL LOG_SIZE_MB, NULL TOTAL, ' LINE FROM DUAL
UNION ALL
( SELECT '  NULL INSERTS, NULL UPDATES, NULL DELETES, NULL OTHERS, NULL LAST_PURGE_DATE FROM DUAL WHERE 1 = 0' FROM DUAL )
UNION ALL
( SELECT 'UNION ALL (' FROM DUAL )
UNION ALL
( SELECT 'SELECT NULL LOG_OWNER, NULL LOG_TABLE, NULL MASTER_TABLE, NULL LOG_SIZE_MB, NULL TOTAL,' FROM DUAL )
UNION ALL
( SELECT '  NULL INSERTS, NULL UPDATES, NULL DELETES, NULL OTHERS, NULL LAST_PURGE_DATE FROM DUAL WHERE 1 = 0' FROM DUAL )
UNION ALL
( SELECT ') UNION ALL ( SELECT * FROM (' FROM DUAL )
UNION ALL
( SELECT '( SELECT NULL LOG_OWNER, NULL LOG_TABLE, NULL MASTER_TABLE, NULL LOG_SIZE_MB, NULL TOTAL, ' FROM DUAL )
UNION ALL
( SELECT '    NULL INSERTS, NULL UPDATES, NULL DELETES, NULL OTHERS, NULL LAST_PURGE_DATE FROM DUAL WHERE 1 = 0 )' FROM DUAL )
UNION ALL
( SELECT 'UNION ALL' FROM DUAL )
UNION ALL
( SELECT
    LINE
  FROM
  ( SELECT 
      LINE_TEXT LINE 
    FROM
    ( SELECT MVIEW_POS, 1 LINE_POS, '( SELECT' LINE_TEXT FROM MVIEW_LOGS
      UNION ALL
      ( SELECT MVIEW_POS,  2, '    ''' || LOG_OWNER || ''' LOG_OWNER,'  FROM MVIEW_LOGS )
      UNION ALL
      ( SELECT MVIEW_POS,  3, '    ''' || LOG_TABLE || ''' LOG_TABLE,' FROM MVIEW_LOGS )
      UNION ALL
      ( SELECT MVIEW_POS,  4, '    ''' || MASTER_TABLE || ''' MASTER_TABLE,' FROM MVIEW_LOGS )
      UNION ALL
      ( SELECT MVIEW_POS,  5, '    TO_CHAR(' || BYTES / 1024 / 1024 || ', 9999990.99) LOG_SIZE_MB,' FROM MVIEW_LOGS )
      UNION ALL
      ( SELECT MVIEW_POS, 10, '    TO_CHAR(COUNT(*), 99999990) TOTAL,' FROM MVIEW_LOGS )
      UNION ALL
      ( SELECT MVIEW_POS, 11, '    TO_CHAR(NVL(SUM(DECODE(DMLTYPE$$, ''I'', 1, 0)), 0), 99999990) INSERTS,' FROM MVIEW_LOGS )
      UNION ALL
      ( SELECT MVIEW_POS, 12, '    TO_CHAR(NVL(SUM(DECODE(DMLTYPE$$, ''U'', 1, 0)), 0), 99999990) UPDATES,' FROM MVIEW_LOGS )
      UNION ALL
      ( SELECT MVIEW_POS, 13, '    TO_CHAR(NVL(SUM(DECODE(DMLTYPE$$, ''D'', 1, 0)), 0), 99999990) DELETES,' FROM MVIEW_LOGS )
      UNION ALL
      ( SELECT MVIEW_POS, 14, '    TO_CHAR(NVL(SUM(DECODE(DMLTYPE$$, ''I'', 0, ''U'', 0, ''D'', 0, 1)), 0), 99999990) OTHERS,' FROM MVIEW_LOGS )
      UNION ALL
      ( SELECT MVIEW_POS, 15, '    ''' || TO_CHAR(LAST_PURGE_DATE, 'dd.mm.yyyy hh24:mi:ss') || ''' LAST_PURGE_DATE' FROM MVIEW_LOGS )
      UNION ALL
      ( SELECT MVIEW_POS, 20, '  FROM' FROM MVIEW_LOGS )
      UNION ALL
      ( SELECT MVIEW_POS, 21, '    "' || LOG_OWNER || '"."' || LOG_TABLE || '"' FROM MVIEW_LOGS )
      UNION ALL
      ( SELECT MVIEW_POS, 30, ')' FROM MVIEW_LOGS )
      UNION ALL
      ( SELECT MVIEW_POS, 31, 'UNION ALL' FROM MVIEW_LOGS )
    )
    ORDER BY
      MVIEW_POS,
      LINE_POS
  )
)
UNION ALL
( SELECT '( SELECT NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL FROM DUAL WHERE 1 = 0 )' FROM DUAL )
UNION ALL
( SELECT '));' FROM DUAL )
));

