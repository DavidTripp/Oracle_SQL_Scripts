SELECT /*+ ALLOW_HINTS */
  NULL OWNER, NULL SEGMENT_NAME, NULL PARTITION_NAME, NULL PART_ROWS, 
  NULL SIZE_MB, NULL "SIZE_%", NULL CREATION_TIME FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL OWNER, NULL SEGMENT_NAME, NULL PARTITION_NAME, NULL PART_ROWS, 
  NULL SIZE_MB, NULL "SIZE_%", NULL CREATION_TIME FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT /*+ MATERIALIZE */
    'SAP%' OWNER,
    '%' SEGMENT_TYPE,           /* TABLE, INDEX */
    'CE1BAT0' SEGMENT_NAME,
    'PART_NAME' ORDER_BY                /* PART_NAME, PART_POSITION */
  FROM
    DUAL
),
PARTITIONS AS
( SELECT /*+ MATERIALIZE */
    TP.TABLE_OWNER OWNER,
    'TABLE PARTITION' SEGMENT_TYPE,
    TP.TABLE_NAME SEGMENT_NAME,
    TP.PARTITION_NAME,
    TP.PARTITION_POSITION,
    TP.NUM_ROWS
  FROM
    BASIS_INFO BI,
    DBA_TAB_PARTITIONS TP
  WHERE
    TP.TABLE_OWNER LIKE BI.OWNER AND
    'TABLE' LIKE BI.SEGMENT_TYPE AND
    TP.TABLE_NAME LIKE BI.SEGMENT_NAME
  UNION ALL
  ( SELECT /*+ MATERIALIZE */
      IP.INDEX_OWNER OWNER,
      'INDEX PARTITION' SEGMENT_TYPE,
      IP.INDEX_NAME SEGMENT_NAME,
      IP.PARTITION_NAME,
      IP.PARTITION_POSITION,
      IP.NUM_ROWS
    FROM
      BASIS_INFO BI,
      DBA_IND_PARTITIONS IP
    WHERE
      IP.INDEX_OWNER LIKE BI.OWNER AND
      'INDEX' LIKE BI.SEGMENT_TYPE AND
      IP.INDEX_NAME LIKE BI.SEGMENT_NAME
  )
),
OBJECTS AS
( SELECT /*+ MATERIALIZE */
    O.OWNER,
    O.OBJECT_TYPE,
    O.OBJECT_NAME,
    O.SUBOBJECT_NAME,
    O.CREATED
  FROM
    BASIS_INFO BI,
    DBA_OBJECTS O
  WHERE
    O.OWNER LIKE BI.OWNER AND
    O.OBJECT_TYPE LIKE BI.SEGMENT_TYPE || '%' AND
    O.OBJECT_NAME LIKE BI.SEGMENT_NAME 
),
SEGMENTS AS
( SELECT /*+ MATERIALIZE */
    DS.OWNER,
    DS.SEGMENT_TYPE,
    DS.SEGMENT_NAME,
    DS.PARTITION_NAME,
    DS.BYTES
  FROM
    BASIS_INFO BI,
    DBA_SEGMENTS DS
  WHERE
    DS.OWNER LIKE BI.OWNER AND
    DS.SEGMENT_TYPE LIKE BI.SEGMENT_TYPE || '%' AND
    DS.SEGMENT_NAME LIKE BI.SEGMENT_NAME
)
SELECT 
  OWNER,
  SEGMENT_NAME,
  PARTITION_NAME,
  TO_CHAR(PART_ROWS, 999999990) PART_ROWS,
  TO_CHAR(BYTES / 1024 / 1024, 9999990.99) SIZE_MB,
  TO_CHAR(RATIO_TO_REPORT(BYTES) OVER (PARTITION BY OWNER, 
    SEGMENT_NAME) * 100, 990.99) "SIZE_%",
  TO_CHAR(CREATED, 'dd.mm.yyyy hh24:mi:ss') CREATION_TIME
FROM
( SELECT 
    P.OWNER,
    P.SEGMENT_TYPE,
    P.SEGMENT_NAME,
    P.PARTITION_NAME,
    P.PARTITION_POSITION PART_POSITION,
    P.NUM_ROWS PART_ROWS,
    NVL(S.BYTES, 0) BYTES,
    O.CREATED,
    BI.ORDER_BY
  FROM
    BASIS_INFO BI,
    PARTITIONS P,
    OBJECTS O,
    SEGMENTS S
  WHERE
    P.OWNER = O.OWNER AND
    P.SEGMENT_TYPE = O.OBJECT_TYPE AND
    P.SEGMENT_NAME = O.OBJECT_NAME AND
    P.PARTITION_NAME = O.SUBOBJECT_NAME AND
    S.OWNER (+) = O.OWNER AND
    S.SEGMENT_TYPE (+) = O.OBJECT_TYPE AND
    S.SEGMENT_NAME (+) = O.OBJECT_NAME AND
    S.PARTITION_NAME (+) = O.SUBOBJECT_NAME
) S
ORDER BY
  S.OWNER,
  S.SEGMENT_NAME,
  DECODE(ORDER_BY, 'PART_NAME', S.PARTITION_NAME, S.PART_POSITION)
));
