SELECT NULL INDEX_NAME, NULL RECORDS_READ, NULL EXECUTIONS,
  NULL ROWS_PER_EXEC, NULL DISTINCT_KEYS, NULL TAB_BLOCKS,
  NULL IND_ROWS, NULL CLUSTERING_FACTOR FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL INDEX_NAME, NULL RECORDS_READ, NULL EXECUTIONS,
  NULL ROWS_PER_EXEC, NULL DISTINCT_KEYS, NULL TAB_BLOCKS,
  NULL IND_ROWS, NULL CLUSTERING_FACTOR FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT
    'SAP%' OWNER,
    'VBFA' TABLE_NAME,
    'ALL' INFO_SOURCE,
    'RECORDS' ORDER_BY
  FROM 
    DUAL
)
SELECT
  INDEX_NAME,
  TO_CHAR(SUM(RECORDS), 99999999990) RECORDS_READ,
  TO_CHAR(SUM(EXECUTIONS), 99999999990) EXECUTIONS,
  TO_CHAR(DECODE(SUM(EXECUTIONS), 0, 0, 
    SUM(RECORDS) / SUM(EXECUTIONS)), 999999990.99) ROWS_PER_EXEC,
  TO_CHAR(DISTINCT_KEYS, 999999999990) DISTINCT_KEYS,
  TO_CHAR(BLOCKS, 999999990) TAB_BLOCKS,
  TO_CHAR(NUM_ROWS, 9999999990) IND_ROWS,
  TO_CHAR(CLUSTERING_FACTOR, 9999999999999990) CLUSTERING_FACTOR
FROM
( SELECT
    I.INDEX_NAME,
    S.SQL_ID,
    I.DISTINCT_KEYS,
    T.BLOCKS,
    I.NUM_ROWS,
    I.CLUSTERING_FACTOR,
    NVL(S.ROWS_PROCESSED, 0) RECORDS,
    NVL(S.EXECUTIONS, 0) EXECUTIONS,
    BI.ORDER_BY
  FROM
    BASIS_INFO BI,
    DBA_TABLES T,
    DBA_INDEXES I,
    V$SQL_PLAN SP,
    V$SQLSTATS S
  WHERE
    BI.INFO_SOURCE IN ('ALL', 'CURRENT') AND
    T.OWNER LIKE BI.OWNER AND
    T.TABLE_NAME LIKE BI.TABLE_NAME AND
    I.TABLE_OWNER = T.OWNER AND
    I.TABLE_NAME = T.TABLE_NAME AND
    SP.OBJECT_OWNER (+) = I.OWNER AND
    SP.OBJECT_NAME (+) = I.INDEX_NAME AND
    SP.OBJECT_TYPE (+) LIKE 'INDEX%' AND
    S.SQL_ID (+) = SP.SQL_ID AND
    S.PLAN_HASH_VALUE (+) = SP.PLAN_HASH_VALUE AND
    I.INDEX_TYPE != 'LOB'
  UNION ALL
  ( SELECT
      I.INDEX_NAME,
      S.SQL_ID,
      I.DISTINCT_KEYS,
      T.BLOCKS,
      I.NUM_ROWS,
      I.CLUSTERING_FACTOR,
      NVL(S.ROWS_PROCESSED_DELTA, 0) RECORDS,
      NVL(S.EXECUTIONS_DELTA, 0) EXECUTIONS,
      BI.ORDER_BY
    FROM
      BASIS_INFO BI,
      DBA_TABLES T,
      DBA_INDEXES I,
      DBA_HIST_SQL_PLAN SP,
      DBA_HIST_SQLSTAT S
    WHERE
      BI.INFO_SOURCE IN ('ALL', 'HISTORY') AND
      T.OWNER LIKE BI.OWNER AND
      T.TABLE_NAME LIKE BI.TABLE_NAME AND
      I.TABLE_OWNER = T.OWNER AND
      I.TABLE_NAME = T.TABLE_NAME AND
      SP.OBJECT_OWNER (+) = I.OWNER AND
      SP.OBJECT_NAME (+) = I.INDEX_NAME AND
      SP.OBJECT_TYPE (+) LIKE 'INDEX%' AND
      S.SQL_ID (+) = SP.SQL_ID AND
      S.PLAN_HASH_VALUE (+) = SP.PLAN_HASH_VALUE AND
    I.INDEX_TYPE != 'LOB'
   )
)
GROUP BY 
  INDEX_NAME,
  DISTINCT_KEYS,
  NUM_ROWS,
  BLOCKS,
  CLUSTERING_FACTOR,
  ORDER_BY
ORDER BY
  DECODE(ORDER_BY,
    'RECORDS', RECORDS_READ,
    'EXECUTIONS', EXECUTIONS, 1) DESC,
  DECODE(ORDER_BY,
    'INDEX', INDEX_NAME, 1)
));