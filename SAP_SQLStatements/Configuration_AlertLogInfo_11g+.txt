SELECT NULL MESSAGE_TIME, NULL MESSAGE_TEXT FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL MESSAGE_TIME, NULL MESSAGE_TEXT FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT 
    BEGIN_DATE,
    END_DATE,
    TO_TIMESTAMP(TO_CHAR(BEGIN_DATE, 'dd.mm.yyyy hh24:mi:ss'), 
      'dd.mm.yyyy hh24:mi:ss') BEGIN_TIME,
    TO_TIMESTAMP(TO_CHAR(END_DATE, 'dd.mm.yyyy hh24:mi:ss'), 
      'dd.mm.yyyy hh24:mi:ss') END_TIME,
    NUM_RECORDS,
    COMPONENT,
    LINE_PATTERN,
    ORDER_BY
  FROM
  ( SELECT
      TO_DATE('01.01.1000 10:00:00', 'dd.mm.yyyy hh24:mi:ss') BEGIN_DATE,
      TO_DATE('31.12.9999 15:05:00', 'dd.mm.yyyy hh24:mi:ss') END_DATE,
      100 NUM_RECORDS,
      'SERVER' COMPONENT,           /* '%' --> all logs, 'SERVER' --> traditional alert log, 'CLIENT', 'LISTENER' */
      '%ORA-%' LINE_PATTERN,
      'DESC' ORDER_BY
    FROM
      DUAL
  )
)
SELECT
  MESSAGE_TIME,
  MESSAGE_TEXT
FROM
( SELECT
    TO_CHAR(A.ORIGINATING_TIMESTAMP, 'dd.mm.yyyy hh24:mi:ss') MESSAGE_TIME,
    A.MESSAGE_TEXT,
    BI.NUM_RECORDS
  FROM
    BASIS_INFO BI,
    V$DIAG_ALERT_EXT A
  WHERE
    A.ORIGINATING_TIMESTAMP BETWEEN BI.BEGIN_TIME AND BI.END_TIME AND
    ( BI.COMPONENT = '%' OR A.COMPONENT_ID = DECODE(BI.COMPONENT, 'SERVER', 
      'rdbms', 'CLIENT', 'client', 'LISTENER', 'tnslsnr') ) AND
    A.MESSAGE_TEXT LIKE BI.LINE_PATTERN
  ORDER BY
    DECODE(BI.ORDER_BY, 'ASC', RECORD_ID, 1), 
    DECODE(BI.ORDER_BY, 'DESC', RECORD_ID, 1) DESC
)
WHERE
  ROWNUM <= NUM_RECORDS
));
