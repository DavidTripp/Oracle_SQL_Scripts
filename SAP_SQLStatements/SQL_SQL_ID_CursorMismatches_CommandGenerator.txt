SELECT NULL LINE FROM DUAL WHERE 1 = 0
UNION ALL ( 
SELECT NULL LINE FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT
    DECODE(INSTANCE_NUMBER, -1, USERENV('INSTANCE'), INSTANCE_NUMBER) INSTANCE_NUMBER,
    SQL_ID
  FROM
  ( SELECT
      -1 INSTANCE_NUMBER,
      '84sud8fphhy29' SQL_ID
    FROM
      DUAL
  )
)
SELECT 'SELECT NULL SQL_ID, NULL MISMATCH_REASON, NULL CURSORS_AFFECTED FROM DUAL WHERE 1 = 0' LINE FROM DUAL
UNION ALL
( SELECT 'UNION ALL (' FROM DUAL )
UNION ALL
( SELECT '  SELECT NULL SQL_ID, NULL MISMATCH_REASON, NULL CURSORS_AFFECTED FROM DUAL WHERE 1 = 0' FROM DUAL )
UNION ALL
( SELECT ') UNION ALL ( SELECT * FROM (' FROM DUAL )
UNION ALL
( SELECT 'WITH SQL_SHARED_CURSOR AS' FROM DUAL )
UNION ALL
( SELECT '( SELECT' FROM DUAL )
UNION ALL
( SELECT 
    '    SUM(DECODE(' || TC.COLUMN_NAME || ' , ''Y'', 1, 0)) ' || TC.COLUMN_NAME || ',' 
  FROM 
    BASIS_INFO BI,
    DBA_TAB_COLUMNS TC
  WHERE
    TC.TABLE_NAME = 'V_$SQL_SHARED_CURSOR' AND
    TC.COLUMN_NAME NOT IN ( 'SQL_ID', 'ADDRESS', 'CHILD_ADDRESS', 'CHILD_NUMBER', 'REASON' )
)
UNION ALL
( SELECT '    '' '' DUMMY' FROM DUAL )
UNION ALL
( SELECT '  FROM' FROM DUAL )
UNION ALL
( SELECT '    GV$SQL_SHARED_CURSOR' FROM DUAL )
UNION ALL
( SELECT '  WHERE' FROM DUAL )
UNION ALL
( SELECT '    INST_ID = ' || INSTANCE_NUMBER || ' AND' FROM BASIS_INFO )
UNION ALL
( SELECT '    SQL_ID LIKE ''' || SQL_ID || '''' FROM BASIS_INFO )
UNION ALL
( SELECT ')' FROM DUAL )
UNION ALL
( SELECT 'SELECT' FROM DUAL )
UNION ALL
( SELECT '  ''' || SQL_ID || ''' SQL_ID,' FROM BASIS_INFO )
UNION ALL
( SELECT '  NAME MISMATCH_REASON,' FROM DUAL )
UNION ALL
( SELECT '  CURSORS_AFFECTED' FROM DUAL )
UNION ALL
( SELECT 'FROM (' FROM DUAL )
UNION ALL
( SELECT 
    '  SELECT ''' || COLUMN_NAME || ''' NAME, ' || COLUMN_NAME || ' CURSORS_AFFECTED FROM SQL_SHARED_CURSOR UNION ALL'
  FROM 
    BASIS_INFO BI,
    DBA_TAB_COLUMNS TC
  WHERE
    TC.TABLE_NAME = 'V_$SQL_SHARED_CURSOR' AND
    TC.COLUMN_NAME NOT IN ( 'SQL_ID', 'ADDRESS', 'CHILD_ADDRESS', 'CHILD_NUMBER', 'REASON' )
)
UNION ALL
( SELECT '  SELECT ''DUMMY'' NAME, 0 CURSORS_AFFECTED FROM DUAL )' FROM DUAL )
UNION ALL
( SELECT 'WHERE' FROM DUAL )
UNION ALL
( SELECT '  CURSORS_AFFECTED > 0' FROM DUAL )
UNION ALL
( SELECT 'ORDER BY' FROM DUAL )
UNION ALL
( SELECT '  CURSORS_AFFECTED DESC' FROM DUAL )
UNION ALL
( SELECT '));' FROM DUAL )
));
