SELECT NULL LINE FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL LINE FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT /*+ MATERIALIZE */
    '%' OWNER,
    'DFKCRPO' TABLE_NAME,
    NULL PARTITION_NAME,       /* NULL if no partitioning */
    28 FILE_ID,
    729446 BLOCK_ID,
    16 POS_ID,               /* -1 for all rows in the block */
    ' ' USE_FLASHBACK_TIME,
    '24.11.2011 12:00:00' FLASHBACK_TIME
  FROM
    DUAL
)
SELECT 'SELECT' LINE FROM DUAL
UNION ALL
( SELECT
    LINE
  FROM
  ( SELECT 
      '  NULL ' || COLUMN_NAME || DECODE(IC.COLUMN_POSITION, 
        MAX(IC.COLUMN_POSITION) OVER (), NULL, ',') LINE 
    FROM 
      BASIS_INFO BI,
      DBA_INDEXES I,
      DBA_IND_COLUMNS IC
    WHERE
      BI.TABLE_NAME = I.TABLE_NAME AND
      I.TABLE_NAME = IC.TABLE_NAME AND
      I.INDEX_NAME = IC.INDEX_NAME AND
      I.UNIQUENESS = 'UNIQUE' AND
      I.INDEX_NAME LIKE '%0'
    ORDER BY
      IC.COLUMN_POSITION
  )
)
UNION ALL
( SELECT ', NULL NRLEVEL' FROM BASIS_INFO WHERE TABLE_NAME = 'NRIV' )
UNION ALL
( SELECT 'FROM DUAL WHERE 1 = 0' LINE FROM DUAL )
UNION ALL
( SELECT 'UNION ALL (' LINE FROM DUAL )
UNION ALL
( SELECT 'SELECT' LINE FROM DUAL )
UNION ALL
( SELECT
    LINE
  FROM
  ( SELECT 
      '  NULL ' || COLUMN_NAME || DECODE(IC.COLUMN_POSITION, 
        MAX(IC.COLUMN_POSITION) OVER (), NULL, ',') LINE 
    FROM 
      BASIS_INFO BI,
      DBA_INDEXES I,
      DBA_IND_COLUMNS IC
    WHERE
      BI.TABLE_NAME = I.TABLE_NAME AND
      I.TABLE_NAME = IC.TABLE_NAME AND
      I.INDEX_NAME = IC.INDEX_NAME AND
      I.UNIQUENESS = 'UNIQUE' AND
      I.INDEX_NAME LIKE '%0'
    ORDER BY
      IC.COLUMN_POSITION
  )
)
UNION ALL
( SELECT ', NULL NRLEVEL' FROM BASIS_INFO WHERE TABLE_NAME = 'NRIV' )
UNION ALL
( SELECT 'FROM DUAL WHERE 1 = 0' LINE FROM DUAL )
UNION ALL
( SELECT ') UNION ALL ( SELECT * FROM (' LINE FROM DUAL )
UNION ALL
( SELECT 'SELECT /*+ ROWID("' || TABLE_NAME || '") */' FROM BASIS_INFO )
UNION ALL
( SELECT
    LINE
  FROM
  ( SELECT 
      '  ' || COLUMN_NAME || DECODE(IC.COLUMN_POSITION, 
        MAX(IC.COLUMN_POSITION) OVER (), NULL, ',') LINE 
    FROM 
      BASIS_INFO BI,
      DBA_INDEXES I,
      DBA_IND_COLUMNS IC
    WHERE
      BI.TABLE_NAME = I.TABLE_NAME AND
      I.TABLE_NAME = IC.TABLE_NAME AND
      I.INDEX_NAME = IC.INDEX_NAME AND
      I.UNIQUENESS = 'UNIQUE' AND
      I.INDEX_NAME LIKE '%0'
    ORDER BY
      IC.COLUMN_POSITION
  )
)
UNION ALL
( SELECT ', NRLEVEL' FROM BASIS_INFO WHERE TABLE_NAME = 'NRIV' )
UNION ALL
( SELECT 'FROM' FROM DUAL )
UNION ALL
( SELECT 
    '  ' || DECODE(BI.OWNER, '%', NULL, '"' || BI.OWNER || '".') ||
      '"' || BI.TABLE_NAME || '"' LINE
  FROM
    BASIS_INFO BI
)
UNION ALL
( SELECT
    'AS OF TIMESTAMP TO_DATE(' || CHR(39) || BI.FLASHBACK_TIME || CHR(39) || ', ' || CHR(39) || 'dd.mm.yyyy hh24:mi:ss' || CHR(39) || ')' LINE
  FROM
    BASIS_INFO BI
  WHERE
    BI.USE_FLASHBACK_TIME = 'X'
)
UNION ALL
( SELECT 'WHERE' FROM DUAL )
UNION ALL
( SELECT
    '  ROWID = DBMS_ROWID.ROWID_CREATE(1, ' || O.DATA_OBJECT_ID || 
      ', ' || BI.FILE_ID || ', ' || BI.BLOCK_ID || 
      ', ' || BI.POS_ID || ')' LINE
  FROM
    BASIS_INFO BI,
    DBA_OBJECTS O
  WHERE
    O.OWNER LIKE BI.OWNER AND
    O.OBJECT_NAME = BI.TABLE_NAME AND
    ( BI.PARTITION_NAME IS NULL OR O.SUBOBJECT_NAME = BI.PARTITION_NAME ) AND
    ( BI.PARTITION_NAME IS NULL AND O.OBJECT_TYPE = 'TABLE' OR
      O.OBJECT_TYPE = 'TABLE PARTITION' ) AND
    BI.POS_ID != -1
)
UNION ALL
( SELECT
    '  ROWID >= DBMS_ROWID.ROWID_CREATE(1, ' || O.DATA_OBJECT_ID || 
      ', ' || BI.FILE_ID || ', ' || BI.BLOCK_ID || ', 0) AND' LINE
  FROM
    BASIS_INFO BI,
    DBA_OBJECTS O
  WHERE
    O.OWNER LIKE BI.OWNER AND
    O.OBJECT_NAME = BI.TABLE_NAME AND
    ( BI.PARTITION_NAME IS NULL OR O.SUBOBJECT_NAME = BI.PARTITION_NAME ) AND
    ( BI.PARTITION_NAME IS NULL AND O.OBJECT_TYPE = 'TABLE' OR
      O.OBJECT_TYPE = 'TABLE PARTITION' ) AND
    BI.POS_ID = -1
)
UNION ALL
( SELECT
    '  ROWID < DBMS_ROWID.ROWID_CREATE(1, ' || O.DATA_OBJECT_ID || 
      ', ' || BI.FILE_ID || ', ' || TO_CHAR(BI.BLOCK_ID + 1) || ', 0)' LINE
  FROM
    BASIS_INFO BI,
    DBA_OBJECTS O
  WHERE
    O.OWNER LIKE BI.OWNER AND
    O.OBJECT_NAME = BI.TABLE_NAME AND
    ( BI.PARTITION_NAME IS NULL OR O.SUBOBJECT_NAME = BI.PARTITION_NAME ) AND
    ( BI.PARTITION_NAME IS NULL AND O.OBJECT_TYPE = 'TABLE' OR
      O.OBJECT_TYPE = 'TABLE PARTITION' ) AND
    BI.POS_ID = -1
)
UNION ALL
( SELECT 'ORDER BY' FROM DUAL )
UNION ALL
( SELECT
    LINE
  FROM
  ( SELECT 
      '  ' || COLUMN_NAME || DECODE(IC.COLUMN_POSITION, 
        MAX(IC.COLUMN_POSITION) OVER (), NULL, ',') LINE 
    FROM 
      BASIS_INFO BI,
      DBA_INDEXES I,
      DBA_IND_COLUMNS IC
    WHERE
      BI.TABLE_NAME = I.TABLE_NAME AND
      I.TABLE_NAME = IC.TABLE_NAME AND
      I.INDEX_NAME = IC.INDEX_NAME AND
      I.UNIQUENESS = 'UNIQUE' AND
      I.INDEX_NAME LIKE '%0'
    ORDER BY
      IC.COLUMN_POSITION
  )
)
UNION ALL
( SELECT ', NRLEVEL' FROM BASIS_INFO WHERE TABLE_NAME = 'NRIV' )
UNION ALL
( SELECT '));' LINE FROM DUAL )
));
     

