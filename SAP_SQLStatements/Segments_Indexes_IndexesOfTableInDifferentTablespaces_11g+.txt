SELECT NULL OWNER, NULL TABLE_NAME, NULL TABLE_TABLESPACE,
  NULL INDEX_TABLESPACES FROM DUAL WHERE 1 = 0
UNION ALL (
SELECT NULL OWNER, NULL TABLE_NAME, NULL TABLE_TABLESPACE,
  NULL INDEX_TABLESPACES FROM DUAL WHERE 1 = 0
) UNION ALL ( SELECT * FROM (
WITH BASIS_INFO AS
( SELECT
    'SAP%' OWNER
  FROM
    DUAL
)
SELECT
  OWNER,
  TABLE_NAME,
  TABLE_TABLESPACE,
  INDEX_TABLESPACES
FROM
( SELECT DISTINCT
    OWNER,
    TABLE_NAME,
    TABLE_TABLESPACE,
    LISTAGG(INDEX_TABLESPACE, ', ') WITHIN GROUP (ORDER BY INDEX_TABLESPACE) OVER 
      (PARTITION BY OWNER, TABLE_NAME) INDEX_TABLESPACES
  FROM
  ( SELECT DISTINCT
      I.OWNER,
      I.TABLE_NAME,
      T.TABLESPACE_NAME TABLE_TABLESPACE,
      I.TABLESPACE_NAME INDEX_TABLESPACE
    FROM
      BASIS_INFO BI,
      DBA_TABLES T,
      DBA_INDEXES I
    WHERE
      I.OWNER LIKE BI.OWNER AND
      T.OWNER = I.TABLE_OWNER AND
      T.TABLE_NAME = I.TABLE_NAME AND
      I.INDEX_TYPE NOT IN ('IOT - TOP', 'LOB')  
  )
)
WHERE
  INDEX_TABLESPACES LIKE '%,%'
ORDER BY
  OWNER,
  TABLE_NAME
));

